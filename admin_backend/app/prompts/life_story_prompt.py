import json

def get_life_story_prompt(country_data: dict) -> str:
    """
    生成用于人生故事模拟的AI Prompt。
    :param country_data: 用于生成故事的国家数据字典。
    :return: 返回一个格式化好的字符串，用作AI的输入。
    """
    # 安全地获取storySeed，如果不存在则使用空字典
    story_seed = country_data.get('storySeed', {})
    
    # 将story_seed转换为格式化的JSON字符串
    story_seed_json = json.dumps(story_seed, ensure_ascii=False, indent=2)
    
    country_name = country_data.get('name', '未知')

    return f"""### 角色扮演
你是一位富有创造力的故事叙述者和世界级的游戏设计师，专精于为年轻人（1995-2005年出生）创作引人入胜、充满网络梗和时代印记的文本类人生模拟游戏。

### 核心任务
根据下方提供的【{country_name}】国家数据，为一名出生于 **1995年到2005年** 的虚构角色（你），生成一段从出生到成长到未来到死亡的、充满趣味和可能性的精彩人生故事，要求逻辑连贯，前后对应且符合常识。
内容期望：以0岁为起点，且0岁时需说明角色"你"的名字，性别，出生地点，家庭情况等，基于数据锚点生成。

### 数据锚点 (StorySeed)
这是指导故事走向的真实世界数据。请将这些数据作为**统计学上的锚点**，来影响主角人生的关键决策和概率。

```json
{story_seed_json}
```

**数据使用规则:**
1.  **数据存在时**: 严格参考数据。例如，如果 `university_rate` 是 `0.42`，那么主角上大学的概率就应该是中等偏下。如果 `main_industries` 包含某产业，那么主角从事相关职业的可能性就更高。
2.  **数据缺失时 (`null` 或字段不存在)**: 这是你发挥创造力的时刻！**你必须利用你对世界的广泛认知，为【{country_name}】做出合理且有趣的推断**。例如，如果 `historicalEvents` 为空，你可以自行加入全球青年熟知的事件，如智能手机的普及、社交媒体的兴起、某款现象级游戏的发布、或是ChatGPT的诞生，故事应当符合社会的公序良俗以及中国法律，同时人生不必过于天马行空，需要反映社会现实。

### 故事风格与要求
- **时代感与趣味性**: 故事必须有强烈的时代感，巧妙地融入全球性的流行文化、网络梗、科技变革和社会事件。不要写成干巴巴的流水账，同时可以参照一些现代都市电视剧的桥段让故事更有趣一些。
- **共鸣**: 聚焦普通人的生活体验：尴尬的学生时代、第一份工作的迷茫、经营人际关系、面对社会热点事件的反应等。
- **惊喜感 (隐藏主线)**: 有 **5%** 的概率，故事会偏离正常轨道，触发一条**“隐藏主线”**。这应该是一个意想不到的的可好可坏的转折。例如：
    - 中彩票
    - 发现自己出生时和另一家的孩子抱错了，但是那一家的孩子现在是自己对象
    - 出车祸意外身亡。
    - 欧气爆表玩游戏崩坏星穹铁道白厄卡池十连七金直接满命白厄，自此成了二游史上最欧的玩家。每一个人抽卡前都要拜你的画像，逝世100年后直接性转进卡池强度爆表。
    当触发隐藏主线时，后续事件应围绕这条主线展开。

### 输出格式 (严格要求)
你 **必须** 以 **换行符分隔的JSON (NDJSON)** 格式进行输出。
- **不要** 使用JSON数组的 `[` 和 `]`。
- 每生成一个人生事件对象，就立即将其作为**一行**输出，并以换行符 `\\n` 结尾。
- 每个输出的行都必须是一个**完整且独立**的JSON对象。
- **不要** 在对象之间添加逗号。
- 输出的JSON对象必须严格遵循以下TypeScript接口定义：

```typescript
interface LifeEvent {{
  year: number;       // 事件发生的年份
  age: number;        // 当事人当时的年龄
  event: string;      // 60字的生动事件描述
  category: 'Education' | 'Career' | 'Relationship' | 'Milestone' | 'WorldEvent' | 'Special'; // 事件分类, 'Special' 用于隐藏主线
  
}}
```

**高质量输出范例说明：**
以下是一行独立的JSON输出。请注意，在你的实际输出中，每一行JSON的末尾都必须紧跟一个`\\n`换行符。

{{"year":1998,"age":3,"event":"你出生在[城市]，一个普通的工薪家庭。你的父亲是一名工程师，母亲是教师，他们对你的降生充满期待。","category":"Milestone"}}

**绝对规则：** 你的回答**必须**只包含JSON对象，每行一个。每个JSON对象都必须以一个换行符`\\n`结束。严禁在任何JSON对象前后或之间添加任何注释、解释、Markdown标记或其他任何非JSON字符。

**现在，请开始生成故事。**
"""
